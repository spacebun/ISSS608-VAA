<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.549">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="dcterms.date" content="2024-02-25">

<title>spacebun - Take-home Exercise 4</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../images/spacebunny.svg" rel="icon" type="image/svg+xml">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script src="../../site_libs/quarto-contrib/iconify-1.0.8/iconify-icon.min.js"></script>
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../../images/spacebunny-banner.png" alt="" class="navbar-logo">
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-iconify-fxemoji-leftwritinghand--hands-on-exercises" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text"><iconify-icon inline="" icon="fxemoji:leftwritinghand"></iconify-icon> Hands-on Exercises</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-iconify-fxemoji-leftwritinghand--hands-on-exercises">    
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex1/Hands-on_Ex1.html">
 <span class="dropdown-text">Hands-on Exercise 1</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex2/Hands-on_Ex2.html">
 <span class="dropdown-text">Hands-on Exercise 2</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex3/Hands-on_Ex3.html">
 <span class="dropdown-text">Hands-on Exercise 3</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex4/Hands-on_Ex4.html">
 <span class="dropdown-text">Hands-on Exercise 4</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex5/Hands-on_Ex5a.html">
 <span class="dropdown-text">Hands-on Exercise 5a</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex5/Hands-on_Ex5b.html">
 <span class="dropdown-text">Hands-on Exercise 5b</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex5/Hands-on_Ex5c.html">
 <span class="dropdown-text">Hands-on Exercise 5c</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex5/Hands-on_Ex5d.html">
 <span class="dropdown-text">Hands-on Exercise 5d</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex5/Hands-on_Ex5e.html">
 <span class="dropdown-text">Hands-on Exercise 5e</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex6/Hands-on_Ex6.html">
 <span class="dropdown-text">Hands-on Exercise 6</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex7/Hands-on_Ex7.html">
 <span class="dropdown-text">Hands-on Exercise 7</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex8/Hands-on_Ex8.html">
 <span class="dropdown-text">Hands-on Exercise 8</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex9/Hands-on_Ex9.html">
 <span class="dropdown-text">Hands-on Exercise 9</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex10/Hands-on_Ex10.html">
 <span class="dropdown-text">Hands-on Exercise 10</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-iconify-fxemoji-redapple--in-class-exercises" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text"><iconify-icon inline="" icon="fxemoji:redapple"></iconify-icon> In-class Exercises</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-iconify-fxemoji-redapple--in-class-exercises">    
        <li>
    <a class="dropdown-item" href="../../In-class_Ex/In-class_Ex1/In-class_Ex1.html">
 <span class="dropdown-text">In-class Exercise 1</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../In-class_Ex/In-class_Ex6/In-class_Ex6.html">
 <span class="dropdown-text">In-class Exercise 6</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-iconify-fxemoji-schoolsatchel--take-home-exercises" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text"><iconify-icon inline="" icon="fxemoji:schoolsatchel"></iconify-icon> Take-home Exercises</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-iconify-fxemoji-schoolsatchel--take-home-exercises">    
        <li>
    <a class="dropdown-item" href="../../Take-home_Ex/Take-home_Ex1/Take-home_Ex1.html">
 <span class="dropdown-text">Take-home Exercise 1</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Take-home_Ex/Take-home_Ex2/Take-home_Ex2.html">
 <span class="dropdown-text">Take-home Exercise 2</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Take-home_Ex/Take-home_Ex3/Take-home_Ex3.html">
 <span class="dropdown-text">Take-home Exercise 3</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Take-home_Ex/Take-home_Ex4/Take-home_Ex4.html">
 <span class="dropdown-text">Take-home Exercise 4</span></a>
  </li>  
    </ul>
  </li>
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../"> 
<span class="menu-text"><iconify-icon inline="" icon="fxemoji:housebuilding"></iconify-icon></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#load-packages" id="toc-load-packages" class="nav-link active" data-scroll-target="#load-packages"><span class="header-section-number">1</span> Load packages</a></li>
  <li><a href="#import-cleaned-data" id="toc-import-cleaned-data" class="nav-link" data-scroll-target="#import-cleaned-data"><span class="header-section-number">2</span> Import cleaned data</a></li>
  <li><a href="#data-wrangling" id="toc-data-wrangling" class="nav-link" data-scroll-target="#data-wrangling"><span class="header-section-number">3</span> Data Wrangling</a></li>
  <li><a href="#exploratory-plot" id="toc-exploratory-plot" class="nav-link" data-scroll-target="#exploratory-plot"><span class="header-section-number">4</span> Exploratory plot</a>
  <ul class="collapse">
  <li><a href="#decomposing-a-time-series-means-separating-it-into-its-constituent-components." id="toc-decomposing-a-time-series-means-separating-it-into-its-constituent-components." class="nav-link" data-scroll-target="#decomposing-a-time-series-means-separating-it-into-its-constituent-components."><span class="header-section-number">4.1</span> Decomposing a time series means separating it into its constituent components.</a></li>
  </ul></li>
  <li><a href="#create-holt-winters-model" id="toc-create-holt-winters-model" class="nav-link" data-scroll-target="#create-holt-winters-model"><span class="header-section-number">5</span> Create Holt-Winters Model</a></li>
  <li><a href="#create-arima" id="toc-create-arima" class="nav-link" data-scroll-target="#create-arima"><span class="header-section-number">6</span> Create ARIMA</a>
  <ul class="collapse">
  <li><a href="#visualization-of-arima-model" id="toc-visualization-of-arima-model" class="nav-link" data-scroll-target="#visualization-of-arima-model"><span class="header-section-number">6.1</span> Visualization of ARIMA Model</a></li>
  </ul></li>
  <li><a href="#create-stlm-model" id="toc-create-stlm-model" class="nav-link" data-scroll-target="#create-stlm-model"><span class="header-section-number">7</span> Create STLM Model</a>
  <ul class="collapse">
  <li><a href="#visualization-of-stlm-using-arima-method" id="toc-visualization-of-stlm-using-arima-method" class="nav-link" data-scroll-target="#visualization-of-stlm-using-arima-method"><span class="header-section-number">7.1</span> Visualization of STLM using ARIMA method</a></li>
  <li><a href="#univariate-time-series-exploration-of-rainfall" id="toc-univariate-time-series-exploration-of-rainfall" class="nav-link" data-scroll-target="#univariate-time-series-exploration-of-rainfall"><span class="header-section-number">7.2</span> Univariate Time Series Exploration of Rainfall</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Take-home Exercise 4</h1>
<p class="subtitle lead">Univariate Time Series</p>
</div>



<div class="quarto-title-meta">

    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">February 25, 2024</p>
    </div>
  </div>
  
    <div>
    <div class="quarto-title-meta-heading">Modified</div>
    <div class="quarto-title-meta-contents">
      <p class="date-modified">March 7, 2024</p>
    </div>
  </div>
    
  </div>
  


</header>


<section id="load-packages" class="level2" data-number="1">
<h2 data-number="1" class="anchored" data-anchor-id="load-packages"><span class="header-section-number">1</span> Load packages</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(tidyverse, naniar,imputeTS, DT, lubridate,</span>
<span id="cb1-2"><a href="#cb1-2"></a>               ggplot2, patchwork, ggthemes,</span>
<span id="cb1-3"><a href="#cb1-3"></a>               tseries, ggHoriPlot, forecast)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="import-cleaned-data" class="level2" data-number="2">
<h2 data-number="2" class="anchored" data-anchor-id="import-cleaned-data"><span class="header-section-number">2</span> Import cleaned data</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a>weather_data <span class="ot">&lt;-</span> <span class="fu">read_rds</span>(<span class="st">"data/weather_imputed.rds"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="data-wrangling" class="level2" data-number="3">
<h2 data-number="3" class="anchored" data-anchor-id="data-wrangling"><span class="header-section-number">3</span> Data Wrangling</h2>
<p>Data: Ang Mo Kio</p>
<p>Time period: 2021-2023</p>
<p>Variable: Mean Temperature</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a><span class="co"># Extract the temperature data into a variable *temp_data*</span></span>
<span id="cb3-2"><a href="#cb3-2"></a>temp_data <span class="ot">&lt;-</span> weather_data <span class="sc">%&gt;%</span></span>
<span id="cb3-3"><a href="#cb3-3"></a>  <span class="fu">select</span>(<span class="fu">c</span>(Station, Date, <span class="st">`</span><span class="at">Mean Temperature (°C)</span><span class="st">`</span>, LAT, LONG))</span>
<span id="cb3-4"><a href="#cb3-4"></a></span>
<span id="cb3-5"><a href="#cb3-5"></a><span class="co"># Filter for a single station, e.g., "Ang Mo Kio"</span></span>
<span id="cb3-6"><a href="#cb3-6"></a>ang_mo_kio_data <span class="ot">&lt;-</span> temp_data <span class="sc">%&gt;%</span> </span>
<span id="cb3-7"><a href="#cb3-7"></a>  <span class="fu">filter</span>(Station <span class="sc">==</span> <span class="st">"Ang Mo Kio"</span>)</span>
<span id="cb3-8"><a href="#cb3-8"></a></span>
<span id="cb3-9"><a href="#cb3-9"></a><span class="co"># Change Date to chr type for time series</span></span>
<span id="cb3-10"><a href="#cb3-10"></a>ang_mo_kio_data<span class="sc">$</span>Date <span class="ot">&lt;-</span> <span class="fu">as.character</span> (ang_mo_kio_data<span class="sc">$</span>Date) </span>
<span id="cb3-11"><a href="#cb3-11"></a><span class="fu">str</span>(ang_mo_kio_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>tibble [1,095 × 5] (S3: tbl_df/tbl/data.frame)
 $ Station              : chr [1:1095] "Ang Mo Kio" "Ang Mo Kio" "Ang Mo Kio" "Ang Mo Kio" ...
 $ Date                 : chr [1:1095] "2021-01-01" "2021-01-02" "2021-01-03" "2021-01-04" ...
 $ Mean Temperature (°C): num [1:1095] 24 23 23.9 25.1 26.9 26.9 24.4 25.3 25.2 23.7 ...
 $ LAT                  : num [1:1095] 1.38 1.38 1.38 1.38 1.38 ...
 $ LONG                 : num [1:1095] 104 104 104 104 104 ...</code></pre>
</div>
</div>
<p>Split data into train test split (0.8)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a><span class="co"># Sort the data by Date if it's not already sorted</span></span>
<span id="cb5-2"><a href="#cb5-2"></a>ang_mo_kio_data <span class="ot">&lt;-</span> ang_mo_kio_data[<span class="fu">order</span>(ang_mo_kio_data<span class="sc">$</span>Date), ]</span>
<span id="cb5-3"><a href="#cb5-3"></a></span>
<span id="cb5-4"><a href="#cb5-4"></a><span class="co"># Split data into training and testing sets based on the 'Date' column</span></span>
<span id="cb5-5"><a href="#cb5-5"></a>train_size <span class="ot">&lt;-</span> <span class="fu">floor</span>(<span class="fu">nrow</span>(ang_mo_kio_data) <span class="sc">*</span> <span class="fl">0.8</span>)  <span class="co"># Calculate the size of the training set</span></span>
<span id="cb5-6"><a href="#cb5-6"></a>train_data <span class="ot">&lt;-</span> ang_mo_kio_data[<span class="dv">1</span><span class="sc">:</span>train_size, ]</span>
<span id="cb5-7"><a href="#cb5-7"></a>test_data <span class="ot">&lt;-</span> ang_mo_kio_data[(train_size <span class="sc">+</span> <span class="dv">1</span>)<span class="sc">:</span><span class="fu">nrow</span>(ang_mo_kio_data), ]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Selecting column Date and Mean Temperature (°C)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a>test_clean <span class="ot">&lt;-</span> test_data <span class="sc">%&gt;%</span> </span>
<span id="cb6-2"><a href="#cb6-2"></a>                <span class="fu">select</span>(Date, <span class="st">`</span><span class="at">Mean Temperature (°C)</span><span class="st">`</span>)</span>
<span id="cb6-3"><a href="#cb6-3"></a></span>
<span id="cb6-4"><a href="#cb6-4"></a>train_clean <span class="ot">&lt;-</span> train_data <span class="sc">%&gt;%</span> </span>
<span id="cb6-5"><a href="#cb6-5"></a>                <span class="fu">select</span>(Date, <span class="st">`</span><span class="at">Mean Temperature (°C)</span><span class="st">`</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Create time series object for data train</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a>ts_train <span class="ot">&lt;-</span> <span class="fu">ts</span>(<span class="at">data =</span> train_clean<span class="sc">$</span><span class="st">`</span><span class="at">Mean Temperature (°C)</span><span class="st">`</span>,</span>
<span id="cb7-2"><a href="#cb7-2"></a>                <span class="at">start =</span> <span class="fu">c</span>(<span class="dv">2021</span>,<span class="dv">01</span>),</span>
<span id="cb7-3"><a href="#cb7-3"></a>                <span class="at">frequency =</span> <span class="dv">365</span>)</span>
<span id="cb7-4"><a href="#cb7-4"></a><span class="fu">autoplot</span>(ts_train)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="timeseries_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Create time series object for data test</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1"></a>ts_test <span class="ot">&lt;-</span> <span class="fu">ts</span>(<span class="at">data =</span> test_clean<span class="sc">$</span><span class="st">`</span><span class="at">Mean Temperature (°C)</span><span class="st">`</span>,</span>
<span id="cb8-2"><a href="#cb8-2"></a>                <span class="at">start =</span> <span class="fu">c</span>(<span class="dv">2023</span>,<span class="dv">05</span>,<span class="dv">27</span>),</span>
<span id="cb8-3"><a href="#cb8-3"></a>                <span class="at">frequency =</span> <span class="dv">365</span>)</span>
<span id="cb8-4"><a href="#cb8-4"></a><span class="fu">autoplot</span>(ts_test)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="timeseries_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="exploratory-plot" class="level2" data-number="4">
<h2 data-number="4" class="anchored" data-anchor-id="exploratory-plot"><span class="header-section-number">4</span> Exploratory plot</h2>
<section id="decomposing-a-time-series-means-separating-it-into-its-constituent-components." class="level3" data-number="4.1">
<h3 data-number="4.1" class="anchored" data-anchor-id="decomposing-a-time-series-means-separating-it-into-its-constituent-components."><span class="header-section-number">4.1</span> Decomposing a time series means separating it into its constituent components.</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a>climate_dc <span class="ot">&lt;-</span> <span class="fu">decompose</span>(ts_train)</span>
<span id="cb9-2"><a href="#cb9-2"></a><span class="fu">plot</span>(climate_dc)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="timeseries_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="create-holt-winters-model" class="level2" data-number="5">
<h2 data-number="5" class="anchored" data-anchor-id="create-holt-winters-model"><span class="header-section-number">5</span> Create Holt-Winters Model</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1"></a>climate_hw <span class="ot">&lt;-</span> <span class="fu">HoltWinters</span>(ts_train,<span class="at">seasonal =</span> <span class="st">"additive"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1"></a><span class="co"># Forecast model</span></span>
<span id="cb11-2"><a href="#cb11-2"></a>climate_forecast <span class="ot">&lt;-</span> <span class="fu">forecast</span>(climate_hw, <span class="at">h=</span><span class="dv">114</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1"></a><span class="co"># Check accuracy</span></span>
<span id="cb12-2"><a href="#cb12-2"></a>forecast<span class="sc">::</span><span class="fu">accuracy</span>(climate_forecast, ts_test)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                      ME     RMSE       MAE         MPE     MAPE      MASE
Training set  0.00279363 1.108857 0.7116148 -0.05696726 2.597585 0.5478908
Test set     -1.57212418 2.195795 1.8045386 -5.82483639 6.639015 1.3893615
                   ACF1 Theil's U
Training set 0.03609098        NA
Test set     0.59056765  2.408303</code></pre>
</div>
</div>
<section id="visualization-of-holt-winters-model" class="level4" data-number="5.0.1">
<h4 data-number="5.0.1" class="anchored" data-anchor-id="visualization-of-holt-winters-model"><span class="header-section-number">5.0.1</span> Visualization of Holt-Winters Model</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1"></a><span class="co"># Visualization</span></span>
<span id="cb14-2"><a href="#cb14-2"></a>ts_train <span class="sc">%&gt;%</span> </span>
<span id="cb14-3"><a href="#cb14-3"></a>  <span class="fu">autoplot</span>(<span class="at">series =</span> <span class="st">"Actual"</span>) <span class="sc">+</span></span>
<span id="cb14-4"><a href="#cb14-4"></a>  <span class="fu">autolayer</span>(climate_forecast<span class="sc">$</span>fitted, <span class="at">series =</span> <span class="st">"Train"</span>) <span class="sc">+</span></span>
<span id="cb14-5"><a href="#cb14-5"></a>  <span class="fu">autolayer</span>(climate_forecast<span class="sc">$</span>mean, <span class="at">series =</span> <span class="st">"Test"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="timeseries_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="create-arima" class="level2" data-number="6">
<h2 data-number="6" class="anchored" data-anchor-id="create-arima"><span class="header-section-number">6</span> Create ARIMA</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1"></a><span class="co"># Check stationarity. Must be stationary to proceed. (p-val &lt;0.05)</span></span>
<span id="cb15-2"><a href="#cb15-2"></a><span class="fu">adf.test</span>(ts_train)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Augmented Dickey-Fuller Test

data:  ts_train
Dickey-Fuller = -5.4569, Lag order = 9, p-value = 0.01
alternative hypothesis: stationary</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1"></a><span class="co"># Create ARIMA on train</span></span>
<span id="cb17-2"><a href="#cb17-2"></a>climate_auto <span class="ot">&lt;-</span> <span class="fu">auto.arima</span>(ts_train, <span class="at">seasonal =</span> T)</span>
<span id="cb17-3"><a href="#cb17-3"></a>climate_auto</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Series: ts_train 
ARIMA(2,1,2) 

Coefficients:
         ar1      ar2      ma1     ma2
      0.7994  -0.0464  -1.3154  0.3494
s.e.  0.2239   0.1193   0.2201  0.2042

sigma^2 = 0.8802:  log likelihood = -1184.2
AIC=2378.4   AICc=2378.47   BIC=2402.27</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1"></a><span class="co"># Forecast</span></span>
<span id="cb19-2"><a href="#cb19-2"></a>climate_auto_f <span class="ot">&lt;-</span> <span class="fu">forecast</span>(climate_auto, <span class="at">h=</span><span class="dv">114</span>)</span>
<span id="cb19-3"><a href="#cb19-3"></a>climate_auto_f</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          Point Forecast    Lo 80    Hi 80    Lo 95    Hi 95
2023.4000       29.14213 27.93982 30.34445 27.30335 30.98092
2023.4027       29.15909 27.82335 30.49483 27.11625 31.20193
2023.4055       29.15212 27.74254 30.56170 26.99636 31.30789
2023.4082       29.14576 27.68747 30.60405 26.91550 31.37602
2023.4110       29.14100 27.64829 30.63371 26.85809 31.42390
2023.4137       29.13749 27.61906 30.65592 26.81525 31.45973
2023.4164       29.13490 27.59627 30.67353 26.78177 31.48804
2023.4192       29.13300 27.57777 30.68822 26.75448 31.51151
2023.4219       29.13160 27.56219 30.70100 26.73140 31.53179
2023.4247       29.13056 27.54865 30.71247 26.71124 31.54989
2023.4274       29.12980 27.53654 30.72306 26.69312 31.56648
2023.4301       29.12924 27.52547 30.73302 26.67648 31.58200
2023.4329       29.12883 27.51514 30.74252 26.66091 31.59675
2023.4356       29.12853 27.50536 30.75169 26.64611 31.61094
2023.4384       29.12830 27.49600 30.76061 26.63191 31.62470
2023.4411       29.12814 27.48694 30.76934 26.61814 31.63814
2023.4438       29.12802 27.47811 30.77792 26.60470 31.65133
2023.4466       29.12793 27.46947 30.78639 26.59153 31.66432
2023.4493       29.12786 27.46097 30.79475 26.57857 31.67715
2023.4521       29.12781 27.45259 30.80304 26.56577 31.68985
2023.4548       29.12778 27.44430 30.81126 26.55312 31.70244
2023.4575       29.12775 27.43609 30.81942 26.54057 31.71493
2023.4603       29.12773 27.42795 30.82752 26.52813 31.72733
2023.4630       29.12772 27.41986 30.83557 26.51578 31.73966
2023.4658       29.12771 27.41184 30.84358 26.50351 31.75191
2023.4685       29.12770 27.40386 30.85154 26.49131 31.76409
2023.4712       29.12769 27.39592 30.85947 26.47918 31.77621
2023.4740       29.12769 27.38803 30.86735 26.46711 31.78827
2023.4767       29.12769 27.38018 30.87520 26.45510 31.80028
2023.4795       29.12768 27.37236 30.88301 26.44315 31.81222
2023.4822       29.12768 27.36458 30.89078 26.43126 31.82411
2023.4849       29.12768 27.35684 30.89852 26.41942 31.83595
2023.4877       29.12768 27.34914 30.90623 26.40763 31.84773
2023.4904       29.12768 27.34146 30.91390 26.39590 31.85946
2023.4932       29.12768 27.33383 30.92153 26.38422 31.87114
2023.4959       29.12768 27.32622 30.92914 26.37258 31.88277
2023.4986       29.12768 27.31865 30.93671 26.36100 31.89436
2023.5014       29.12768 27.31110 30.94425 26.34947 31.90589
2023.5041       29.12768 27.30359 30.95176 26.33798 31.91737
2023.5068       29.12768 27.29612 30.95924 26.32654 31.92881
2023.5096       29.12768 27.28867 30.96669 26.31515 31.94020
2023.5123       29.12768 27.28125 30.97411 26.30381 31.95155
2023.5151       29.12768 27.27386 30.98150 26.29251 31.96285
2023.5178       29.12768 27.26650 30.98886 26.28125 31.97411
2023.5205       29.12768 27.25917 30.99619 26.27004 31.98532
2023.5233       29.12768 27.25187 31.00349 26.25887 31.99648
2023.5260       29.12768 27.24459 31.01076 26.24775 32.00761
2023.5288       29.12768 27.23735 31.01801 26.23667 32.01869
2023.5315       29.12768 27.23013 31.02523 26.22563 32.02973
2023.5342       29.12768 27.22294 31.03242 26.21463 32.04072
2023.5370       29.12768 27.21578 31.03958 26.20368 32.05168
2023.5397       29.12768 27.20864 31.04672 26.19276 32.06259
2023.5425       29.12768 27.20153 31.05383 26.18189 32.07347
2023.5452       29.12768 27.19445 31.06091 26.17105 32.08430
2023.5479       29.12768 27.18739 31.06797 26.16026 32.09510
2023.5507       29.12768 27.18036 31.07500 26.14950 32.10585
2023.5534       29.12768 27.17335 31.08201 26.13879 32.11657
2023.5562       29.12768 27.16637 31.08899 26.12811 32.12725
2023.5589       29.12768 27.15941 31.09595 26.11747 32.13789
2023.5616       29.12768 27.15248 31.10288 26.10687 32.14849
2023.5644       29.12768 27.14557 31.10979 26.09630 32.15906
2023.5671       29.12768 27.13868 31.11667 26.08577 32.16959
2023.5699       29.12768 27.13182 31.12354 26.07528 32.18008
2023.5726       29.12768 27.12498 31.13037 26.06482 32.19054
2023.5753       29.12768 27.11817 31.13719 26.05440 32.20096
2023.5781       29.12768 27.11138 31.14398 26.04401 32.21134
2023.5808       29.12768 27.10461 31.15075 26.03366 32.22169
2023.5836       29.12768 27.09786 31.15749 26.02334 32.23201
2023.5863       29.12768 27.09114 31.16422 26.01306 32.24229
2023.5890       29.12768 27.08444 31.17092 26.00281 32.25254
2023.5918       29.12768 27.07776 31.17760 25.99260 32.26276
2023.5945       29.12768 27.07110 31.18425 25.98242 32.27294
2023.5973       29.12768 27.06447 31.19089 25.97227 32.28309
2023.6000       29.12768 27.05785 31.19751 25.96215 32.29321
2023.6027       29.12768 27.05126 31.20410 25.95207 32.30329
2023.6055       29.12768 27.04468 31.21067 25.94201 32.31334
2023.6082       29.12768 27.03813 31.21723 25.93199 32.32336
2023.6110       29.12768 27.03160 31.22376 25.92200 32.33335
2023.6137       29.12768 27.02509 31.23027 25.91204 32.34331
2023.6164       29.12768 27.01860 31.23676 25.90212 32.35324
2023.6192       29.12768 27.01212 31.24323 25.89222 32.36314
2023.6219       29.12768 27.00567 31.24968 25.88235 32.37301
2023.6247       29.12768 26.99924 31.25612 25.87251 32.38284
2023.6274       29.12768 26.99283 31.26253 25.86271 32.39265
2023.6301       29.12768 26.98643 31.26892 25.85293 32.40243
2023.6329       29.12768 26.98006 31.27530 25.84318 32.41218
2023.6356       29.12768 26.97370 31.28165 25.83346 32.42190
2023.6384       29.12768 26.96737 31.28799 25.82377 32.43159
2023.6411       29.12768 26.96105 31.29431 25.81410 32.44125
2023.6438       29.12768 26.95475 31.30061 25.80447 32.45089
2023.6466       29.12768 26.94847 31.30689 25.79486 32.46050
2023.6493       29.12768 26.94220 31.31315 25.78528 32.47008
2023.6521       29.12768 26.93596 31.31940 25.77573 32.47963
2023.6548       29.12768 26.92973 31.32563 25.76620 32.48915
2023.6575       29.12768 26.92352 31.33184 25.75670 32.49865
2023.6603       29.12768 26.91732 31.33803 25.74723 32.50812
2023.6630       29.12768 26.91115 31.34421 25.73779 32.51757
2023.6658       29.12768 26.90499 31.35037 25.72837 32.52699
2023.6685       29.12768 26.89885 31.35651 25.71898 32.53638
2023.6712       29.12768 26.89272 31.36263 25.70961 32.54575
2023.6740       29.12768 26.88661 31.36874 25.70027 32.55509
2023.6767       29.12768 26.88052 31.37483 25.69095 32.56441
2023.6795       29.12768 26.87445 31.38091 25.68166 32.57370
2023.6822       29.12768 26.86839 31.38697 25.67239 32.58296
2023.6849       29.12768 26.86235 31.39301 25.66315 32.59220
2023.6877       29.12768 26.85632 31.39904 25.65394 32.60142
2023.6904       29.12768 26.85031 31.40505 25.64474 32.61061
2023.6932       29.12768 26.84432 31.41104 25.63558 32.61978
2023.6959       29.12768 26.83834 31.41702 25.62643 32.62892
2023.6986       29.12768 26.83237 31.42298 25.61731 32.63804
2023.7014       29.12768 26.82643 31.42893 25.60822 32.64714
2023.7041       29.12768 26.82049 31.43486 25.59914 32.65621
2023.7068       29.12768 26.81458 31.44078 25.59009 32.66526
2023.7096       29.12768 26.80867 31.44668 25.58107 32.67429</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1"></a><span class="co"># Check accuracy</span></span>
<span id="cb21-2"><a href="#cb21-2"></a><span class="fu">accuracy</span>(climate_auto_f, ts_test)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                      ME      RMSE       MAE         MPE     MAPE      MASE
Training set  0.03777592 0.9354911 0.7423579  0.03391425 2.688186 0.5715608
Test set     -1.55415777 1.8291975 1.6636117 -5.76272036 6.124617 1.2808582
                     ACF1 Theil's U
Training set -0.002187051        NA
Test set      0.454551561   2.00749</code></pre>
</div>
</div>
<section id="visualization-of-arima-model" class="level3" data-number="6.1">
<h3 data-number="6.1" class="anchored" data-anchor-id="visualization-of-arima-model"><span class="header-section-number">6.1</span> Visualization of ARIMA Model</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1"></a><span class="co"># Visualization</span></span>
<span id="cb23-2"><a href="#cb23-2"></a>ts_train <span class="sc">%&gt;%</span> </span>
<span id="cb23-3"><a href="#cb23-3"></a>  <span class="fu">autoplot</span>(<span class="at">series =</span> <span class="st">"Actual"</span>) <span class="sc">+</span></span>
<span id="cb23-4"><a href="#cb23-4"></a>  <span class="fu">autolayer</span>(climate_auto_f<span class="sc">$</span>fitted, <span class="at">series =</span> <span class="st">"Train"</span>) <span class="sc">+</span></span>
<span id="cb23-5"><a href="#cb23-5"></a>  <span class="fu">autolayer</span>(climate_auto_f<span class="sc">$</span>mean, <span class="at">series =</span> <span class="st">"Test"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="timeseries_files/figure-html/unnamed-chunk-17-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="create-stlm-model" class="level2" data-number="7">
<h2 data-number="7" class="anchored" data-anchor-id="create-stlm-model"><span class="header-section-number">7</span> Create STLM Model</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1"></a><span class="co"># Create STLM</span></span>
<span id="cb24-2"><a href="#cb24-2"></a>climate_stlm <span class="ot">&lt;-</span> <span class="fu">stlm</span>(<span class="at">y=</span> ts_train,</span>
<span id="cb24-3"><a href="#cb24-3"></a>                     <span class="at">s.window =</span> <span class="dv">356</span>,</span>
<span id="cb24-4"><a href="#cb24-4"></a>                     <span class="at">method =</span> <span class="st">"arima"</span>)</span>
<span id="cb24-5"><a href="#cb24-5"></a></span>
<span id="cb24-6"><a href="#cb24-6"></a><span class="fu">summary</span>(climate_stlm<span class="sc">$</span>model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Series: x 
ARIMA(3,1,1) 

Coefficients:
         ar1     ar2     ar3      ma1
      0.4536  0.1477  0.0489  -0.9890
s.e.  0.0344  0.0370  0.0343   0.0068

sigma^2 = 0.5041:  log likelihood = -940.99
AIC=1891.98   AICc=1892.05   BIC=1915.85

Training set error measures:
                     ME      RMSE       MAE        MPE     MAPE      MASE
Training set 0.02123722 0.7079672 0.5637753 0.01390915 2.032402 0.4340655
                     ACF1
Training set -0.004173344</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1"></a><span class="co"># Forecast</span></span>
<span id="cb26-2"><a href="#cb26-2"></a>climate_stlm_forecast <span class="ot">&lt;-</span> <span class="fu">forecast</span>(climate_stlm, <span class="at">h =</span> <span class="dv">114</span>)</span>
<span id="cb26-3"><a href="#cb26-3"></a>climate_stlm_forecast</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          Point Forecast    Lo 80    Hi 80    Lo 95    Hi 95
2023.4000       29.39782 28.48793 30.30772 28.00626 30.78939
2023.4027       29.29445 28.29116 30.29774 27.76005 30.82885
2023.4055       29.58440 28.52630 30.64251 27.96617 31.20263
2023.4082       30.09815 29.00628 31.19002 28.42827 31.76802
2023.4110       29.80276 28.69226 30.91327 28.10440 31.50113
2023.4137       29.35643 28.23473 30.47814 27.64093 31.07193
2023.4164       28.45948 27.33085 29.58811 26.73339 30.18557
2023.4192       28.71166 27.57862 29.84471 26.97882 30.44450
2023.4219       29.31331 28.17734 30.44928 27.57600 31.05063
2023.4247       28.66457 27.52657 29.80256 26.92416 30.40498
2023.4274       29.31552 28.17606 30.45497 27.57287 31.05817
2023.4301       28.36625 27.22569 29.50681 26.62191 30.11058
2023.4329       28.66681 27.52538 29.80824 26.92114 30.41248
2023.4356       28.46725 27.32510 29.60940 26.72049 30.21402
2023.4384       28.51761 27.37484 29.66037 26.76990 30.26531
2023.4411       27.86789 26.72459 29.01119 26.11936 29.61642
2023.4438       28.41813 27.27433 29.56192 26.66885 30.16740
2023.4466       27.81832 26.67408 28.96257 26.06835 29.56830
2023.4493       28.41849 27.27382 29.56317 26.66787 30.16912
2023.4521       27.66865 26.52356 28.81373 25.91740 29.41989
2023.4548       27.11878 25.97330 28.26425 25.36693 28.87063
2023.4575       28.16890 27.02304 29.31476 26.41646 29.92134
2023.4603       26.81902 25.67278 27.96526 25.06600 28.57204
2023.4630       27.56918 26.42257 28.71579 25.81560 29.32277
2023.4658       27.31934 26.17237 28.46632 25.56519 29.07349
2023.4685       28.01950 26.87216 29.16684 26.26479 29.77421
2023.4712       28.16965 27.02195 29.31736 26.41439 29.92491
2023.4740       28.11980 26.97174 29.26787 26.36399 29.87562
2023.4767       28.31995 27.17153 29.46838 26.56359 30.07632
2023.4795       27.22010 26.07132 28.36889 25.46319 28.97702
2023.4822       28.22025 27.07111 29.36939 26.46279 29.97771
2023.4849       28.37040 27.22090 29.51990 26.61239 30.12841
2023.4877       28.42055 27.27069 29.57040 26.66200 30.17910
2023.4904       28.12069 26.97048 29.27091 26.36160 29.87979
2023.4932       27.77084 26.62027 28.92141 26.01120 29.53048
2023.4959       29.37099 28.22006 30.52191 27.61080 31.13117
2023.4986       29.27114 28.11986 30.42241 27.51040 31.03187
2023.5014       29.07128 27.91965 30.22292 27.31001 30.83256
2023.5041       27.92143 26.76944 29.07342 26.15961 29.68325
2023.5068       27.72157 26.56923 28.87392 25.95921 29.48394
2023.5096       28.12172 26.96902 29.27442 26.35882 29.88462
2023.5123       29.07187 27.91881 30.22492 27.30842 30.83531
2023.5151       28.97201 27.81860 30.12542 27.20802 30.73600
2023.5178       29.37216 28.21840 30.52593 27.60763 31.13669
2023.5205       26.87231 25.71819 28.02643 25.10723 28.63738
2023.5233       27.32245 26.16798 28.47693 25.55684 29.08807
2023.5260       27.67260 26.51777 28.82743 25.90644 29.43876
2023.5288       26.82275 25.66756 27.97793 25.05605 28.58945
2023.5315       27.87289 26.71736 29.02843 26.10565 29.64013
2023.5342       28.67304 27.51715 29.82893 26.90526 30.44082
2023.5370       29.37304 28.21680 30.52929 27.60472 31.14137
2023.5397       29.77305 28.61645 30.92965 28.00419 31.54192
2023.5425       29.77306 28.61611 30.93001 28.00365 31.54246
2023.5452       29.37306 28.21576 30.53037 27.60312 31.14301
2023.5479       28.42307 27.26541 29.58073 26.65258 30.19356
2023.5507       29.17308 28.01506 30.33109 27.40205 30.94410
2023.5534       28.77308 27.61472 29.93145 27.00152 30.54465
2023.5562       28.82309 27.66437 29.98181 27.05098 30.59520
2023.5589       28.17310 27.01402 29.33217 26.40045 29.94574
2023.5616       28.47310 27.31368 29.63253 26.69992 30.24629
2023.5644       28.12311 26.96333 29.28289 26.34938 29.89684
2023.5671       29.57312 28.41299 30.73325 27.79885 31.34738
2023.5699       29.32312 28.16264 30.48361 27.54832 31.09793
2023.5726       28.82313 27.66229 29.98396 27.04779 30.59847
2023.5753       29.52314 28.36195 30.68432 27.74725 31.29902
2023.5781       28.57314 27.41160 29.73468 26.79672 30.34956
2023.5808       27.92315 26.76126 29.08504 26.14619 29.70011
2023.5836       27.87316 26.71091 29.03540 26.09566 29.65065
2023.5863       27.32316 26.16057 28.48576 25.54513 29.10120
2023.5890       26.62317 25.46022 27.78612 24.84459 28.40174
2023.5918       28.62317 27.45988 29.78647 26.84406 30.40229
2023.5945       29.02318 27.85953 30.18683 27.24353 30.80283
2023.5973       28.57319 27.40919 29.73719 26.79300 30.35338
2023.6000       28.42319 27.25884 29.58755 26.64247 30.20392
2023.6027       29.17320 28.00850 30.33791 27.39194 30.95446
2023.6055       29.67321 28.50815 30.83826 27.89141 31.45501
2023.6082       29.52321 28.35781 30.68862 27.74088 31.30555
2023.6110       29.12322 27.95746 30.28898 27.34035 30.90609
2023.6137       27.82323 26.65712 28.98934 26.03982 29.60664
2023.6164       27.82346 26.65700 28.98992 26.03952 29.60741
2023.6192       28.42370 27.25689 29.59051 26.63922 30.20818
2023.6219       27.67394 26.50677 28.84110 25.88892 29.45895
2023.6247       28.02417 26.85666 29.19168 26.23862 29.80973
2023.6274       27.42441 26.25655 28.59227 25.63832 29.21050
2023.6301       27.87464 26.70643 29.04286 26.08802 29.66127
2023.6329       26.62488 25.45632 27.79344 24.83772 28.41204
2023.6356       26.97512 25.80620 28.14403 25.18742 28.76281
2023.6384       27.87535 26.70609 29.04461 26.08712 29.66358
2023.6411       26.97559 25.80598 28.14520 25.18682 28.76435
2023.6438       26.37582 25.20586 27.54579 24.58652 28.16513
2023.6466       26.72606 25.55575 27.89637 24.93622 28.51590
2023.6493       26.57630 25.40563 27.74696 24.78592 28.36667
2023.6521       26.82653 25.65552 27.99754 25.03563 28.61744
2023.6548       27.77677 26.60541 28.94813 25.98533 29.56821
2023.6575       26.62700 25.45530 27.79871 24.83503 28.41898
2023.6603       26.32724 25.15518 27.49930 24.53473 28.11975
2023.6630       27.97748 26.80507 29.14988 26.18443 29.77052
2023.6658       28.22771 27.05496 29.40047 26.43414 30.02129
2023.6685       26.07795 24.90484 27.25105 24.28384 27.87206
2023.6712       28.32818 27.15473 29.50164 26.53354 30.12283
2023.6740       27.92842 26.75462 29.10222 26.13325 29.72359
2023.6767       27.77866 26.60451 28.95281 25.98295 29.57436
2023.6795       28.17889 27.00439 29.35339 26.38265 29.97513
2023.6822       27.77913 26.60428 28.95397 25.98235 29.57590
2023.6849       28.32936 27.15417 29.50456 26.53206 30.12667
2023.6877       28.07960 26.90406 29.25514 26.28176 29.87744
2023.6904       27.87912 26.70323 29.05502 26.08075 29.67749
2023.6932       28.12865 26.95241 29.30489 26.32975 29.92755
2023.6959       28.77817 27.60159 29.95476 26.97874 30.57761
2023.6986       27.02770 25.85076 28.20463 25.22773 28.82766
2023.7014       27.57722 26.39994 28.75450 25.77672 29.37772
2023.7041       28.52675 27.34912 29.70437 26.72572 30.32777
2023.7068       28.82627 27.64829 30.00425 27.02471 30.62783
2023.7096       28.97579 27.79747 30.15412 27.17370 30.77788</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1"></a><span class="co"># Check Accuracy</span></span>
<span id="cb28-2"><a href="#cb28-2"></a></span>
<span id="cb28-3"><a href="#cb28-3"></a><span class="fu">accuracy</span>(climate_stlm_forecast, ts_test)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                      ME      RMSE       MAE         MPE     MAPE      MASE
Training set  0.02123722 0.7079672 0.5637753  0.01539662 2.040041 0.4340654
Test set     -0.92999525 1.5477016 1.2977256 -3.49412016 4.766063 0.9991529
                     ACF1 Theil's U
Training set -0.004173344        NA
Test set      0.481711859  1.695064</code></pre>
</div>
</div>
<section id="visualization-of-stlm-using-arima-method" class="level3" data-number="7.1">
<h3 data-number="7.1" class="anchored" data-anchor-id="visualization-of-stlm-using-arima-method"><span class="header-section-number">7.1</span> Visualization of STLM using ARIMA method</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1"></a>ts_train <span class="sc">%&gt;%</span> </span>
<span id="cb30-2"><a href="#cb30-2"></a>  <span class="fu">autoplot</span>(<span class="at">series =</span> <span class="st">"Actual"</span>) <span class="sc">+</span></span>
<span id="cb30-3"><a href="#cb30-3"></a>  <span class="fu">autolayer</span>(climate_stlm_forecast<span class="sc">$</span>fitted, <span class="at">series =</span> <span class="st">"Train"</span>) <span class="sc">+</span></span>
<span id="cb30-4"><a href="#cb30-4"></a>  <span class="fu">autolayer</span>(climate_stlm_forecast<span class="sc">$</span>mean, <span class="at">series =</span> <span class="st">"Test"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="timeseries_files/figure-html/unnamed-chunk-21-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="univariate-time-series-exploration-of-rainfall" class="level3" data-number="7.2">
<h3 data-number="7.2" class="anchored" data-anchor-id="univariate-time-series-exploration-of-rainfall"><span class="header-section-number">7.2</span> Univariate Time Series Exploration of Rainfall</h3>
<p>In this section, we focus on the variable “Daily Rainfall Total (mm)” for one weather station, Ang Mo Kio .</p>
<section id="data-preparation-extract-rainfall-data-for-ang-mo-kio" class="level4" data-number="7.2.1">
<h4 data-number="7.2.1" class="anchored" data-anchor-id="data-preparation-extract-rainfall-data-for-ang-mo-kio"><span class="header-section-number">7.2.1</span> Data preparation: Extract rainfall data for Ang Mo Kio</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1"></a><span class="co"># Extract the rainfall data into a variable *rain_data*</span></span>
<span id="cb31-2"><a href="#cb31-2"></a>rain_data <span class="ot">&lt;-</span> weather_data <span class="sc">%&gt;%</span></span>
<span id="cb31-3"><a href="#cb31-3"></a>  <span class="fu">select</span>(<span class="fu">c</span>(Station, Date, <span class="st">`</span><span class="at">Daily Rainfall Total (mm)</span><span class="st">`</span>, LAT, LONG))</span>
<span id="cb31-4"><a href="#cb31-4"></a></span>
<span id="cb31-5"><a href="#cb31-5"></a><span class="fu">str</span>(rain_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>tibble [7,665 × 5] (S3: tbl_df/tbl/data.frame)
 $ Station                  : chr [1:7665] "Ang Mo Kio" "Ang Mo Kio" "Ang Mo Kio" "Ang Mo Kio" ...
 $ Date                     : Date[1:7665], format: "2021-01-01" "2021-01-02" ...
 $ Daily Rainfall Total (mm): num [1:7665] 94.4 114.4 5.2 0 0 ...
 $ LAT                      : num [1:7665] 1.38 1.38 1.38 1.38 1.38 ...
 $ LONG                     : num [1:7665] 104 104 104 104 104 ...</code></pre>
</div>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1"></a><span class="co"># Filter for a single station, e.g., "Ang Mo Kio"</span></span>
<span id="cb33-2"><a href="#cb33-2"></a>ang_mo_kio_data <span class="ot">&lt;-</span> rain_data <span class="sc">%&gt;%</span> </span>
<span id="cb33-3"><a href="#cb33-3"></a>  <span class="fu">filter</span>(Station <span class="sc">==</span> <span class="st">"Ang Mo Kio"</span>)</span>
<span id="cb33-4"><a href="#cb33-4"></a></span>
<span id="cb33-5"><a href="#cb33-5"></a><span class="fu">str</span>(ang_mo_kio_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>tibble [1,095 × 5] (S3: tbl_df/tbl/data.frame)
 $ Station                  : chr [1:1095] "Ang Mo Kio" "Ang Mo Kio" "Ang Mo Kio" "Ang Mo Kio" ...
 $ Date                     : Date[1:1095], format: "2021-01-01" "2021-01-02" ...
 $ Daily Rainfall Total (mm): num [1:1095] 94.4 114.4 5.2 0 0 ...
 $ LAT                      : num [1:1095] 1.38 1.38 1.38 1.38 1.38 ...
 $ LONG                     : num [1:1095] 104 104 104 104 104 ...</code></pre>
</div>
</div>
</section>
<section id="time-series-plot" class="level4" data-number="7.2.2">
<h4 data-number="7.2.2" class="anchored" data-anchor-id="time-series-plot"><span class="header-section-number">7.2.2</span> Time series plot</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1"></a><span class="co"># Plotting Mean Temperature as an example</span></span>
<span id="cb35-2"><a href="#cb35-2"></a><span class="fu">ggplot</span>(ang_mo_kio_data, <span class="fu">aes</span>(<span class="at">x =</span> Date, <span class="at">y =</span> <span class="st">`</span><span class="at">Daily Rainfall Total (mm)</span><span class="st">`</span>)) <span class="sc">+</span></span>
<span id="cb35-3"><a href="#cb35-3"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span> </span>
<span id="cb35-4"><a href="#cb35-4"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Daily Rainfall Total (mm) Over Time at Ang Mo Kio"</span>, <span class="at">x =</span> <span class="st">"Date"</span>, <span class="at">y =</span> <span class="st">"Daily Rainfall Total (mm)"</span>) <span class="sc">+</span></span>
<span id="cb35-5"><a href="#cb35-5"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="timeseries_files/figure-html/unnamed-chunk-23-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="seasonality-and-trend-analysis" class="level4" data-number="7.2.3">
<h4 data-number="7.2.3" class="anchored" data-anchor-id="seasonality-and-trend-analysis"><span class="header-section-number">7.2.3</span> Seasonality and Trend Analysis</h4>
<p>Done using the <code>stl()</code> function for seasonal-trend decomposition using LOESS.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1"></a>ts_data <span class="ot">&lt;-</span> <span class="fu">ts</span>(ang_mo_kio_data<span class="sc">$</span><span class="st">`</span><span class="at">Daily Rainfall Total (mm)</span><span class="st">`</span>, <span class="at">frequency =</span> <span class="dv">365</span>)</span>
<span id="cb36-2"><a href="#cb36-2"></a></span>
<span id="cb36-3"><a href="#cb36-3"></a>decomposed_data <span class="ot">&lt;-</span> <span class="fu">stl</span>(ts_data, <span class="at">s.window =</span> <span class="st">"periodic"</span>)</span>
<span id="cb36-4"><a href="#cb36-4"></a><span class="fu">plot</span>(decomposed_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="timeseries_files/figure-html/unnamed-chunk-24-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="autocorrelation-analysis" class="level4" data-number="7.2.4">
<h4 data-number="7.2.4" class="anchored" data-anchor-id="autocorrelation-analysis"><span class="header-section-number">7.2.4</span> Autocorrelation Analysis</h4>
<p>To help with identifying how values are related to their lagged versions.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1"></a><span class="fu">acf</span>(ts_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="timeseries_files/figure-html/unnamed-chunk-25-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1"></a><span class="fu">pacf</span>(ts_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="timeseries_files/figure-html/unnamed-chunk-25-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="stationarity-check" class="level4" data-number="7.2.5">
<h4 data-number="7.2.5" class="anchored" data-anchor-id="stationarity-check"><span class="header-section-number">7.2.5</span> Stationarity Check</h4>
<p>Many forecasting models assume that the time series is stationary. Use the Augmented Dickey-Fuller (ADF) test to check for stationarity.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1"></a><span class="fu">adf.test</span>(ts_data, <span class="at">alternative =</span> <span class="st">"stationary"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Augmented Dickey-Fuller Test

data:  ts_data
Dickey-Fuller = -10.13, Lag order = 10, p-value = 0.01
alternative hypothesis: stationary</code></pre>
</div>
</div>
</section>
<section id="distribution-of-the-variable" class="level4" data-number="7.2.6">
<h4 data-number="7.2.6" class="anchored" data-anchor-id="distribution-of-the-variable"><span class="header-section-number">7.2.6</span> Distribution of the Variable</h4>
<p>Examine the distribution of your variable to identify any skewness, kurtosis, or outliers.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1"></a><span class="fu">ggplot</span>(ang_mo_kio_data, <span class="fu">aes</span>(<span class="at">x =</span> <span class="st">`</span><span class="at">Daily Rainfall Total (mm)</span><span class="st">`</span>)) <span class="sc">+</span></span>
<span id="cb41-2"><a href="#cb41-2"></a>  <span class="fu">geom_histogram</span>(<span class="at">bins =</span> <span class="dv">30</span>, <span class="at">fill =</span> <span class="st">"blue"</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb41-3"><a href="#cb41-3"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Distribution of Daily Rainfall at Ang Mo Kio"</span>, <span class="at">x =</span> <span class="st">"Daily Rainfall Total (mm)"</span>, <span class="at">y =</span> <span class="st">"Frequency"</span>) <span class="sc">+</span></span>
<span id="cb41-4"><a href="#cb41-4"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="timeseries_files/figure-html/unnamed-chunk-27-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>


</section>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>